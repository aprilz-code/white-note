### <center>Mysql优化
***
##  MySQL优化大体可分为4个方面
		1 硬件和操作系统层面的优化
		
		2 架构设计层面的的优化
		
		3 MySQL程序配置优化
		
		4 SQL执行优化

## 硬件和操作系统层面的优化
- 硬件：影响MySQL性能因素的主要是cpu，可用内存大小和磁盘读写速度，网络带宽 。
- 操作系统：应用文件句柄数，操作系统的网络配置都会影响到MySQL的性能。

## 架构设计层面的的优化
MySQL是一个磁盘IO访问非常频繁的关系型数据库，在高并发和高性能的场景中，MySQL必然会承受巨大的并发压力。在此时我们优化的方式主要可以分为以下几个部分
- 集群：搭建MySQL主从集群，单个MySQL服务容易导致单点故障，一旦服务宕机，将会导致依赖数据库的应用全部无法响应，主从集群或者主主集群都可以保证服务的高可用性
- 读写分离：在读多写少的场景中，通过读写分离的方案，可以去避免读写冲突导致的性能问题。
- 分库分表：可以降低单个服务器节省的一个IO压力，通过分表的方式可以去降低单表数据量从而去提升sql查询效率。
- 热点数据：可以引入更为高效的分布数据库，比如说Redis，MongoDB，ElasticSearch等。缓解查询压力，还能提升查询性能。

## MySQL程序配置优化 
MySQL是一个经过互联网检验过的生产级别的成熟数据库，对于MySQL数据库本身的优化一般可以通过MySQL配置文件my.cnf来完成。比如MySQL连接数，以及开启binlog日志等。得根据具体环境进行调配。

## SQL执行优化 
可分为以下三个方面
- 慢SQL定位和排查：可通过慢查询日志或者慢查询日志工具分析，得到有问题的SQL列表。 [开启慢查询日志](https://blog.csdn.net/qq_39291929/article/details/81561388)
- 执行计划分析： 可通过explain关键字来取查看当前SQL的执行计划，可以重点关注type，key，rows，Filterd等。  
  **type**表示MySQL在表中找到所需行的方式，又称“访问类型”。
  常用的类型有： ALL, index,  range, ref, eq_ref, const, system, NULL（从左到右，性能从差到好）
  **key**列显示MySQL实际决定使用的键（索引）
  如果没有选择索引，键是NULL。要想强制MySQL使用或忽视possible_keys列中的索引，在查询中使用FORCE INDEX、USE INDEX或者IGNORE INDEX。
  **rows**表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数   
  **Filtered**表示返回结果的行数占需读取行数的百分比 Filtered列的值越大越好 Filtered列的值依赖于统计信息
- 使用show profile工具：是Mysql提供的查看SQL语句资源消耗情况的工具，可以用于SQL调优的测量。默认关闭，打开后会保存最近15次的运行结果，针对运行慢的SQL通过profile工具详细分析，可以得到SQL执行过程中所有资源的开销情况，如IO开销，CPU开销，内存开销等等。[profile开启方法](https://www.cnblogs.com/573734817pc/p/10766667.html)


在两个表进行连接时，用**小表来驱动大表**可以提高系统的执行效率。
 ```
两表连接时，先执行的是两个表的笛卡尔积，接着是 on 的条件筛选，然后是 join 类型进行外部行的添加。

如果是 inner join，没有什么差别；

如果是 left join，就应该把大表放在后面；

如果是 right join，就应该把大表放在前面。
```
 

```sql
select * from A where id in(select id from b);
```

当B表的数据集必须小于A表的数据集时，用in优于exists.
